{% extends "base.html" %}
{% load static %}

{% block css %}
  <link rel="stylesheet"
        type="text/css"
        href="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.css" />
  <link rel="stylesheet" type="text/css" href="{% static "css/daterangepicker-bootstrap-dark.css" %}" />
{% endblock css %}

{% block title %}
  Statistics - Yamtrack
{% endblock title %}

{% block container %}
  <div class="d-flex flex-column align-items-center">

    <h2>Activity History</h2>
    <div class="d-flex justify-content-start justify-content-xxl-center w-100 overflow-x-scroll overflow-y-hidden py-3">
      <div class="contribution-graph">
        <!-- Months row -->
        <div class="d-flex mb-1 months gap-1">
          {% for month, week_count in month_data %}
            <div class="month small text-secondary"
                 style="width: calc(({{ week_count }} * var(--square-size)) + (({{ week_count }} - 1) * var(--gap-size)))">
              {{ month }}
            </div>
          {% endfor %}
        </div>

        <!-- Graph wrapper -->
        <div class="d-flex gap-1">
          <!-- Weekday labels -->
          <div class="d-flex flex-column gap-1 pe-2">
            {% for weekday in weekdays %}
              {% if forloop.counter0|divisibleby:2 %}
                <div class="weekday-label small text-secondary">{{ weekday }}</div>
              {% else %}
                <div class="weekday-label"></div>
              {% endif %}
            {% endfor %}
          </div>

          <!-- Weeks grid -->
          <div class="d-flex gap-1">
            {% for week in calendar_weeks %}
              <div class="d-flex flex-column gap-1">
                {% for day in week %}
                  <div class="day"
                       data-level="{{ day.level }}"
                       data-bs-toggle="tooltip"
                       data-bs-title="{{ day.count }} action{{ day.count|pluralize }} on {{ day.date }}"></div>
                {% endfor %}
              </div>
            {% endfor %}
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock container %}

{% block js %}
  <script type="text/javascript"
          src="https://cdn.jsdelivr.net/jquery/latest/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
  <script type="text/javascript"
          src="https://cdn.jsdelivr.net/momentjs/latest/moment.min.js"></script>
  <script type="text/javascript"
          src="https://cdn.jsdelivr.net/npm/daterangepicker/daterangepicker.min.js"></script>
  <script src="{% static 'js/date-range.js' %}"></script>

  {% comment %} Enable bootstrap tooltips {% endcomment %}
  <script>
    const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
    const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
  </script>
{% endblock js %}
